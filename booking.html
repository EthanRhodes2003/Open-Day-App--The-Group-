<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Day Signup</title>
  <link rel="stylesheet" href="css/booking.css">
</head>
<body>

<!-- Mobile Frame -->
<div class="mobileFrame">
  
  <!-- Title Bar -->
  <div class="titleBar">
    <a href="homepage.html" class="backButton">&larr;</a>
    <div class="logo">Open Day Signup</div>
  </div>

  <!-- Main Content -->
  <div class="mobileContent">
    <div class="formContainer">

      <h1>Register for Open Day</h1>

      <form id="signupForm">
        <!-- Year of Entry -->
        <div class="formElement">
          <label for="entryYear" class="formLabel">Year of Entry</label>
          <select id="entryYear" name="entryYear" required>
            <option value="" disabled selected>Select year</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
            <option value="2027">2027</option>
            <option value="2028">2028</option>
          </select>
        </div>

        <!-- Education Level -->
        <div class="formElement">
          <label for="educationLevel" class="formLabel">Education Level</label>
          <select id="educationLevel" name="educationLevel" required>
            <option value="" disabled selected>Select level</option>
            <option value="level-4">Level 4 (Certificate)</option>
            <option value="level-5">Level 5 (Diploma/Foundation)</option>
            <option value="level-6">Level 6 (Bachelor's Degree)</option>
            <option value="level-7">Level 7 (Master's Degree)</option>
            <option value="level-8">Level 8 (Doctorate)</option>
          </select>
        </div>

        <!-- Subject Interest -->
        <div class="formElement">
          <label for="subjectInterest" class="formLabel">Subject Interest</label>
          <select id="subjectInterest" name="subjectInterest" required>
            <option value="" disabled selected>Select subject</option>
            <option value="arts">Arts & Humanities</option>
            <option value="business">Business & Economics</option>
            <option value="engineering">Engineering</option>
            <option value="science">Science</option>
            <option value="medicine">Medicine</option>
            <option value="law">Law</option>
            <option value="education">Education</option>
            <option value="social-sciences">Social Sciences</option>
          </select>
        </div>

        <!-- Contact Preference -->
        <div class="formElement">
          <label for="contactPreference" class="formLabel">Contact Preference</label>
          <select id="contactPreference" name="contactPreference" required>
            <option value="" disabled selected>Select preference</option>
            <option value="email">Email</option>
            <option value="phone">Phone</option>
            <option value="sms">SMS</option>
          </select>
        </div>

        <!-- Booking Date (Populated from DB) -->
        <div class="formElement">
          <label for="bookingDate" class="formLabel">Open Day Date</label>
          <select id="bookingDate" name="bookingDate" required>
            <option value="" disabled selected>Select date</option>
            <!-- Event dates will be added dynamically here -->
          </select>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn">Register</button>
      </form>

      <!-- Display message after form submission -->
      <div id="message"></div>
    </div>
  </div>

</div>

<script>
// Fetch event dates and populate the bookingDate dropdown
async function loadEventDates() {
  try {
    // Fetch event dates from the eventdates.php script
    const response = await fetch('../php/eventdates.php');
    const events = await response.json();

    const bookingDateSelect = document.getElementById('bookingDate');

    // Clear the dropdown first to avoid duplicate options
    bookingDateSelect.innerHTML = '<option value="" disabled selected>Select date</option>';

    // Check if events were fetched successfully
    if (Array.isArray(events) && events.length > 0) {
      const seenDates = new Set(); // To track already seen dates

      // Populate the event dates dynamically
      events.forEach(event => {
        const formattedDate = event.EventDate;  // Already in 'YYYY-MM-DD' format from PHP
        
        // Prevent duplicates by checking against seenDates set
        if (!seenDates.has(formattedDate)) {
          const option = document.createElement('option');
          option.value = formattedDate;  // Use the 'YYYY-MM-DD' format as value
          option.textContent = new Date(formattedDate).toLocaleDateString();  // Display the formatted date

          bookingDateSelect.appendChild(option);
          seenDates.add(formattedDate);  // Mark this date as seen
        }
      });
    } else {
      // If no events are available, show a message
      const option = document.createElement('option');
      option.disabled = true;
      option.textContent = 'No open day events available';
      bookingDateSelect.appendChild(option);
    }
  } catch (error) {
    console.error('Error loading event dates:', error);
    const bookingDateSelect = document.getElementById('bookingDate');
    const option = document.createElement('option');
    option.disabled = true;
    option.textContent = 'Error loading event dates';
    bookingDateSelect.appendChild(option);
  }
}

// Call the function to load event dates when the page loads
loadEventDates();

</script>

<script src="js/booking.js"></script>
</body>
</html>
